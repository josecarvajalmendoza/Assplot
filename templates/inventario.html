{% extends "layout.html" %}

{% block title %}Gestión de Inventario - As Plot Center{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Gestión de Inventario</h1>
    <p>Administra el stock de materiales y suministros</p>
    <div class="header-actions">
        <a href="{{ url_for('materiales') }}" class="btn btn-secondary">
            <i class="fas fa-list"></i>
            Gestionar Materiales
        </a>
        <a href="{{ url_for('crear_material') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Nuevo Material
        </a>
    </div>
</div>

{% if materiales_bajo_stock %}
<div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>¡Atención!</strong> Hay {{ materiales_bajo_stock|length }} materiales con stock bajo.
</div>
{% endif %}

<div class="search-section">
    <form method="GET" class="search-form">
        <div class="search-input">
            <i class="fas fa-search"></i>
            <input type="text" name="search" placeholder="Buscar materiales..." value="{{ search }}">
        </div>
        <select name="categoria" class="filter-select">
            <option value="">Todas las Categorías</option>
            <option value="papel" {% if categoria == 'papel' %}selected{% endif %}>Papel</option>
            <option value="tinta" {% if categoria == 'tinta' %}selected{% endif %}>Tinta</option>
            <option value="herramienta" {% if categoria == 'herramienta' %}selected{% endif %}>Herramientas</option>
            <option value="otro" {% if categoria == 'otro' %}selected{% endif %}>Otros</option>
        </select>
        <button type="submit" class="btn btn-secondary">
            <i class="fas fa-filter"></i>
            Filtrar
        </button>
    </form>
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Material</th>
                <th>Categoría</th>
                <th>Subcategoría</th>
                <th>Cantidad</th>
                <th>Stock Mínimo</th>
                <th>Ubicación</th>
                <th>Precio Unitario</th>
                <th>Valor Total</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for inventario in inventarios %}
            <tr {% if inventario.necesita_reposicion %}class="row-warning"{% endif %}>
                <td>
                    <strong>{{ inventario.material.nombre_material }}</strong>
                    <br>
                    <small>{{ inventario.material.descripcion }}</small>
                </td>
                <td>
                    <span class="badge badge-{{ inventario.material.categoria }}">
                        {{ inventario.material.categoria.title() }}
                    </span>
                </td>
                <td>{{ inventario.material.subcategoria or '-' }}</td>
                <td class="text-center">
                    <strong>{{ inventario.cantidad }}</strong> {{ inventario.material.unidad_medida }}
                </td>
                <td class="text-center">{{ inventario.material.stock_minimo }}</td>
                <td>{{ inventario.ubicacion or 'No especificada' }}</td>
                <td class="text-right">${{ "%.2f"|format(inventario.material.precio_unitario) }}</td>
                <td class="text-right">
                    <strong>${{ "%.2f"|format(inventario.valor_total) }}</strong>
                </td>
                <td>
                    {% if inventario.necesita_reposicion %}
                    <span class="status-badge status-warning">
                        <i class="fas fa-exclamation-circle"></i> Stock Bajo
                    </span>
                    {% else %}
                    <span class="status-badge status-success">
                        <i class="fas fa-check-circle"></i> Normal
                    </span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('ajustar_inventario', id=inventario.id_inventario) }}" 
                           class="btn btn-sm btn-primary" title="Ajustar Stock">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="10" class="text-center">
                    <div class="no-data">
                        <i class="fas fa-box-open"></i>
                        <p>No hay materiales en el inventario</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="summary-section">
    <div class="summary-card">
        <h3>Total de Materiales</h3>
        <p class="summary-value">{{ inventarios|length }}</p>
    </div>
    <div class="summary-card">
        <h3>Materiales con Stock Bajo</h3>
        <p class="summary-value warning">{{ materiales_bajo_stock|length }}</p>
    </div>
    <div class="summary-card">
        <h3>Valor Total del Inventario</h3>
        <p class="summary-value">${{ "%.2f"|format(inventarios|sum(attribute='valor_total')) }}</p>
    </div>
</div>
{% endblock %}