{% extends "layout.html" %}

{% block title %}Gestión de Usuarios - As Plot Center{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Gestión de Usuarios</h1>
    <p>Administra los usuarios del sistema</p>
    <a href="{{ url_for('crear_usuario') }}" class="btn btn-primary">
        <i class="fas fa-user-plus"></i>
        Crear Usuario
    </a>
</div>

<!-- Barra de búsqueda y filtros -->
<div class="search-section">
    <form method="GET" class="search-form">
        <div class="search-input">
            <i class="fas fa-search"></i>
            <input type="text" name="search" placeholder="Buscar usuarios..." value="{{ search }}">
        </div>
        <select name="rol" class="filter-select">
            <option value="">Todos los Roles</option>
            <option value="administrador" {% if rol == 'administrador' %}selected{% endif %}>Administrador</option>
            <option value="laboral" {% if rol == 'laboral' %}selected{% endif %}>Laboral</option>
            <option value="cliente" {% if rol == 'cliente' %}selected{% endif %}>Cliente</option>
        </select>
        <button type="submit" class="btn btn-secondary">
            <i class="fas fa-filter"></i>
            Filtrar
        </button>
    </form>
</div>

<!-- Tabla de usuarios -->
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Nombre Completo</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Teléfono</th>
                <th>Fecha Creación</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <td>{{ usuario.id_usuario }}</td>
                <td><strong>{{ usuario.nombre_usuario }}</strong></td>
                <td>{{ usuario.nombre_completo or '-' }}</td>
                <td>{{ usuario.email }}</td>
                <td>
                    <span class="badge badge-{{ usuario.rol }}">
                        {% if usuario.rol == 'administrador' %}
                            <i class="fas fa-crown"></i>
                        {% elif usuario.rol == 'laboral' %}
                            <i class="fas fa-briefcase"></i>
                        {% else %}
                            <i class="fas fa-user"></i>
                        {% endif %}
                        {{ usuario.rol.title() }}
                    </span>
                </td>
                <td>{{ usuario.telefono or '-' }}</td>
                <td>{{ usuario.fecha_creacion.strftime('%d/%m/%Y') if usuario.fecha_creacion else '-' }}</td>
                <td>
                    {% if usuario.activo %}
                    <span class="status-badge status-success">
                        <i class="fas fa-check-circle"></i> Activo
                    </span>
                    {% else %}
                    <span class="status-badge status-danger">
                        <i class="fas fa-times-circle"></i> Inactivo
                    </span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('editar_usuario', id=usuario.id_usuario) }}" 
                           class="btn btn-sm btn-primary" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% if usuario.id_usuario != current_user.id_usuario %}
                        <a href="{{ url_for('eliminar_usuario', id=usuario.id_usuario) }}" 
                           class="btn btn-sm btn-red" title="Desactivar"
                           onclick="return confirm('¿Estás seguro de desactivar este usuario?')">
                            <i class="fas fa-user-slash"></i>
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" class="text-center">
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>No hay usuarios registrados</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Resumen -->
<div class="summary-section">
    <div class="summary-card">
        <h3>Total de Usuarios</h3>
        <p class="summary-value">{{ usuarios|length }}</p>
    </div>
    <div class="summary-card">
        <h3>Administradores</h3>
        <p class="summary-value">{{ usuarios|selectattr('rol', 'equalto', 'administrador')|list|length }}</p>
    </div>
    <div class="summary-card">
        <h3>Usuarios Laborales</h3>
        <p class="summary-value">{{ usuarios|selectattr('rol', 'equalto', 'laboral')|list|length }}</p>
    </div>
    <div class="summary-card">
        <h3>Clientes</h3>
        <p class="summary-value">{{ usuarios|selectattr('rol', 'equalto', 'cliente')|list|length }}</p>
    </div>
</div>
{% endblock %}