{% extends "layout.html" %}

{% block title %}Búsqueda Avanzada de Planos - As Plot Center{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Búsqueda Avanzada de Planos</h1>
    <p>Encuentra planos utilizando múltiples criterios de búsqueda</p>
    <a href="{{ url_for('planos') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i>
        Volver a Planos
    </a>
</div>

<!-- Formulario de búsqueda avanzada -->
<div class="search-advanced-form">
    <form method="GET" action="{{ url_for('buscar_planos') }}">
        <div class="form-grid">
            <div class="form-group">
                <label for="q">Búsqueda General</label>
                <input type="text" id="q" name="q" class="form-control" 
                       placeholder="Nombre del plano, proyecto o cliente" value="{{ query }}">
            </div>
            
            <div class="form-group">
                <label for="tipo">Tipo de Plano</label>
                <select id="tipo" name="tipo" class="form-control">
                    <option value="">Todos los tipos</option>
                    {% for tipo_plano in tipos_plano %}
                    <option value="{{ tipo_plano.id_tipo_plano }}" 
                            {% if tipo|string == tipo_plano.id_tipo_plano|string %}selected{% endif %}>
                        {{ tipo_plano.nombre_tipo }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="proyecto">Proyecto</label>
                <select id="proyecto" name="proyecto" class="form-control">
                    <option value="">Todos los proyectos</option>
                    {% for proy in proyectos %}
                    <option value="{{ proy.id_proyecto }}" 
                            {% if proyecto|string == proy.id_proyecto|string %}selected{% endif %}>
                        {{ proy.nombre_proyecto }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="fecha_desde">Fecha Desde</label>
                <input type="date" id="fecha_desde" name="fecha_desde" 
                       class="form-control" value="{{ fecha_desde }}">
            </div>
            
            <div class="form-group">
                <label for="fecha_hasta">Fecha Hasta</label>
                <input type="date" id="fecha_hasta" name="fecha_hasta" 
                       class="form-control" value="{{ fecha_hasta }}">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Resultados de búsqueda -->
{% if query or tipo or proyecto or fecha_desde or fecha_hasta %}
<div class="search-results">
    <h3>Resultados de Búsqueda ({{ planos|length }} planos encontrados)</h3>
    
    {% if planos %}
    <div class="plans-grid">
        {% for plano in planos %}
        <div class="plan-card">
            <div class="plan-header">
                <h3>{{ plano.nombre_plano }}</h3>
                <div class="plan-type">
                    <span class="type-badge type-{{ plano.tipo_plano.nombre_tipo.lower() }}">
                        {{ plano.tipo_plano.nombre_tipo }}
                    </span>
                </div>
            </div>
            
            <div class="plan-details">
                <div class="detail-item">
                    <i class="fas fa-user"></i>
                    <span>{{ plano.proyecto.cliente.nombre_completo }}</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-calendar"></i>
                    <span>{{ plano.fecha_subida.strftime('%Y-%m-%d') }}</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-folder"></i>
                    <span>{{ plano.proyecto.nombre_proyecto }}</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-file"></i>
                    <span>{{ plano.archivo.split('.')[-1].upper() }}</span>
                </div>
            </div>
            
            <div class="plan-actions">
                <a href="{{ url_for('detalle_plano', id=plano.id_plano) }}" 
                   class="btn btn-sm btn-info">
                    <i class="fas fa-info-circle"></i>
                    Detalle
                </a>
                <a href="{{ url_for('ver_plano', id=plano.id_plano) }}" 
                   class="btn btn-sm btn-green" target="_blank">
                    <i class="fas fa-eye"></i>
                    Ver
                </a>
                <a href="{{ url_for('descargar_plano', id=plano.id_plano) }}" 
                   class="btn btn-sm btn-blue">
                    <i class="fas fa-download"></i>
                    Descargar
                </a>
                <a href="{{ url_for('eliminar_plano', id=plano.id_plano) }}" 
                   class="btn btn-sm btn-red"
                   onclick="return confirm('¿Estás seguro de que quieres eliminar este plano?')">
                    <i class="fas fa-trash"></i>
                    Eliminar
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-data">
        <i class="fas fa-search"></i>
        <p>No se encontraron planos con los criterios especificados</p>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}